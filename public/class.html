<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" type="image/png" href="/favicon.png">
  <title>Class Management</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen">
  <nav class="bg-white shadow p-4 flex justify-between items-center">
    <h1 class="text-xl font-bold">Recita</h1>
    <div class="flex gap-4 items-center">
      <span id="className" class="text-lg font-medium text-gray-700"></span>
      <button onclick="window.location.href='dashboard.html'" class="text-blue-500 hover:underline">Back to Dashboard</button>
    </div>
  </nav>
  
  <!-- Custom Confirmation Modal -->
  <div id="confirmationModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
    <div class="bg-white rounded-xl p-6 w-full max-w-md mx-4 shadow-xl">
      <h3 id="confirmTitle" class="text-lg font-semibold text-gray-800 mb-4">Confirm Action</h3>
      <p id="confirmMessage" class="text-gray-600 mb-6">Are you sure you want to proceed?</p>
      <div class="flex justify-end gap-3">
        <button id="confirmCancel" class="px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 transition">
          Cancel
        </button>
        <button id="confirmOk" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition">
          Delete
        </button>
      </div>
    </div>
  </div>
  
  <main class="p-6 max-w-7xl mx-auto">
    <!-- Two Column Layout for Desktop, Stacked for Mobile -->
    <div class="grid lg:grid-cols-2 gap-6">
      
      <!-- Left Column: Recitas Management (Top on Mobile) -->
      <div class="space-y-6 order-1 lg:order-1">
        <!-- Create New Recita -->
        <div class="bg-white rounded-xl shadow p-6">
          <h2 class="text-lg font-bold mb-4">Create New Recita</h2>
          <form id="createRecitaForm" class="space-y-4">
            <input id="recitaTopic" type="text" placeholder="Recita topic" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-200 focus:border-blue-500 outline-none" required>
            <div class="flex gap-2">
              <button type="submit" class="flex-1 bg-green-500 text-white p-3 rounded-lg hover:bg-green-600 transition flex items-center justify-center gap-2">
                <span id="createBtnText">Create Recita</span>
                <svg id="createBtnSpinner" class="hidden animate-spin h-4 w-4" fill="none" viewBox="0 0 24 24">
                  <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                  <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path>
                </svg>
              </button>
              <button type="button" id="exportSelectedBtn" class="bg-purple-500 text-white p-3 rounded-lg hover:bg-purple-600 disabled:opacity-50 transition" disabled>
                Export Selected
              </button>
            </div>
          </form>
        </div>

        <!-- Recitas List -->
        <div class="bg-white rounded-xl shadow p-6">
          <div class="flex justify-between items-center mb-4">
            <h2 class="text-lg font-bold">Recitas</h2>
            <div class="flex items-center gap-2">
              <input type="checkbox" id="selectAllRecitas" class="rounded">
              <label for="selectAllRecitas" class="text-sm text-gray-600">Select All</label>
            </div>
          </div>
          <div id="recitasList" class="space-y-3 max-h-96 overflow-y-auto">
            <div class="flex flex-col items-center gap-2 text-gray-500 py-8">
              <svg class="animate-spin h-6 w-6 text-blue-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path>
              </svg>
              <span>Loading recitas...</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Right Column: Students Management (Bottom on Mobile) -->
      <div class="space-y-6 order-2 lg:order-2">
        <!-- Add Students Section -->
        <div class="bg-white rounded-xl shadow p-6">
          <h2 class="text-lg font-bold mb-4">Add Students</h2>
          <textarea id="studentInput" placeholder="One student per line" class="w-full p-3 border border-gray-300 rounded-lg h-32 mb-4 focus:ring-2 focus:ring-blue-200 focus:border-blue-500 outline-none"></textarea>
          <button id="addStudentsBtn" class="w-full bg-blue-500 text-white p-3 rounded-lg hover:bg-blue-600 transition flex items-center justify-center gap-2">
            <span id="addBtnText">Add Students</span>
            <svg id="addBtnSpinner" class="hidden animate-spin h-4 w-4" fill="none" viewBox="0 0 24 24">
              <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
              <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path>
            </svg>
          </button>
        </div>

        <!-- Students List -->
        <div class="bg-white rounded-xl shadow p-6">
          <div class="flex justify-between items-center mb-4">
            <h2 class="text-lg font-bold">Students</h2>
            <span id="studentCount" class="text-sm text-gray-500">0 students</span>
          </div>
          <div id="studentList" class="space-y-2 max-h-96 overflow-y-auto">
            <div class="flex flex-col items-center gap-2 text-gray-500 py-8">
              <svg class="animate-spin h-6 w-6 text-blue-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path>
              </svg>
              <span>Loading students...</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <script>
    // Global variables
    let currentClassId = null;
    let students = [];
    let recitas = [];
    let confirmCallback = null;

    // Helper function to escape HTML
    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    // Custom confirmation modal
    function showConfirmation(title, message, onConfirm) {
      const modal = document.getElementById('confirmationModal');
      const titleEl = document.getElementById('confirmTitle');
      const messageEl = document.getElementById('confirmMessage');
      
      titleEl.textContent = title;
      messageEl.textContent = message;
      confirmCallback = onConfirm;
      
      modal.classList.remove('hidden');
      modal.classList.add('flex');
    }

    // Get class ID from URL
    function getClassIdFromUrl() {
      const urlParams = new URLSearchParams(window.location.search);
      return urlParams.get('id');
    }

    // Load class information
    async function loadClassInfo() {
      currentClassId = getClassIdFromUrl();
      if (!currentClassId) {
        alert('No class ID provided');
        window.location.href = 'dashboard.html';
        return;
      }

      try {
        // Get class info from the classes endpoint
        const response = await fetch('/classes', {
          credentials: 'same-origin'
        });
        
        if (response.ok) {
          const classes = await response.json();
          const currentClass = classes.find(c => c.id == currentClassId);
          
          if (currentClass) {
            document.getElementById('className').textContent = currentClass.name;
          } else {
            throw new Error('Class not found');
          }
        } else {
          throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }
      } catch (error) {
        console.error('Error loading class info:', error);
        alert('Error loading class information');
        window.location.href = 'dashboard.html';
      }
    }

    // Load students using your existing API
    async function loadStudents() {
      const studentList = document.getElementById('studentList');
      const studentCount = document.getElementById('studentCount');
      
      // Show loading state
      studentList.innerHTML = `
        <div class="flex flex-col items-center gap-2 text-gray-500 py-8">
          <svg class="animate-spin h-6 w-6 text-blue-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path>
          </svg>
          <span>Loading students...</span>
        </div>
      `;

      try {
        const response = await fetch(`/students?classId=${currentClassId}`, {
          credentials: 'same-origin'
        });
        
        if (!response.ok) {
          throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }
        
        students = await response.json();
        renderStudents();
      } catch (error) {
        console.error('Error loading students:', error);
        studentList.innerHTML = `
          <div class="text-center py-8">
            <p class="text-red-500 mb-2">Failed to load students</p>
            <p class="text-sm text-gray-500">${error.message}</p>
            <button onclick="loadStudents()" class="mt-3 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition">
              Try Again
            </button>
          </div>
        `;
      }
    }

    // Load recitas using your attendance API
    async function loadRecitas() {
      const recitasList = document.getElementById('recitasList');
      
      // Show loading state
      recitasList.innerHTML = `
        <div class="flex flex-col items-center gap-2 text-gray-500 py-8">
          <svg class="animate-spin h-6 w-6 text-blue-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path>
          </svg>
          <span>Loading recitas...</span>
        </div>
      `;

      try {
        const response = await fetch(`/attendance?action=getRecitas&classId=${currentClassId}`, {
          credentials: 'same-origin'
        });
        
        if (response.ok) {
          const data = await response.json();
          recitas = Array.isArray(data) ? data : [];
          console.log('Loaded recitas:', recitas);
        } else {
          console.log('Error loading recitas:', response.status, response.statusText);
          recitas = [];
        }
        renderRecitas();
      } catch (error) {
        console.error('Error loading recitas:', error);
        recitas = [];
        renderRecitas();
      }
    }

    // Render students list
    function renderStudents() {
      const studentList = document.getElementById('studentList');
      const studentCount = document.getElementById('studentCount');
      
      studentCount.textContent = `${students.length} student${students.length !== 1 ? 's' : ''}`;
      
      if (students.length === 0) {
        studentList.innerHTML = `
          <div class="text-center py-12">
            <div class="text-4xl mb-4">👥</div>
            <p class="text-gray-500 text-lg mb-2">No students added yet</p>
            <p class="text-sm text-gray-400">Add students using the form above</p>
          </div>
        `;
        return;
      }

      studentList.innerHTML = students.map(student => `
        <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg group hover:bg-gray-100 transition">
          <div class="flex items-center flex-1">
            <input type="text" value="${escapeHtml(student.name)}" 
                   class="bg-transparent border-none outline-none flex-1 font-medium focus:bg-white focus:border focus:border-blue-300 focus:rounded px-2 py-1"
                   onblur="updateStudentName(${student.id}, this.value)"
                   onkeypress="if(event.key==='Enter') this.blur()">
          </div>
          <button onclick="confirmDeleteStudent(${student.id}, '${escapeHtml(student.name)}')" 
                  class="opacity-0 group-hover:opacity-100 text-red-500 hover:text-red-700 p-1 transition-opacity">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
            </svg>
          </button>
        </div>
      `).join('');
    }

    // Render recitas list
    function renderRecitas() {
      const recitasList = document.getElementById('recitasList');
      
      if (recitas.length === 0) {
        recitasList.innerHTML = `
          <div class="text-center py-12">
            <div class="text-4xl mb-4">📝</div>
            <p class="text-gray-500 text-lg mb-2">No recitas created yet</p>
            <p class="text-sm text-gray-400">Create your first recita using the form above</p>
          </div>
        `;
        return;
      }

      recitasList.innerHTML = recitas.map(recita => {
        const date = new Date(recita.created_at);
        const dateStr = date.toLocaleDateString();
        const timeStr = date.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
        
        return `
          <div class="border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow bg-white">
            <div class="flex items-start justify-between mb-2">
              <div class="flex items-center gap-3">
                <input type="checkbox" class="recita-checkbox rounded" value="${recita.id}" 
                       onchange="updateExportButton()">
                <div>
                  <h3 class="font-semibold text-gray-900">${escapeHtml(recita.topic)}</h3>
                  <p class="text-sm text-gray-600">${dateStr} at ${timeStr}</p>
                  <p class="text-xs text-gray-500">
                    ${recita.student_count || 0} student${(recita.student_count || 0) !== 1 ? 's' : ''} participated
                  </p>
                </div>
              </div>
              <div class="flex gap-2">
                <button onclick="editRecita(${recita.id})" 
                        class="text-blue-500 hover:text-blue-700 p-1 transition">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                  </svg>
                </button>
                <button onclick="confirmDeleteRecita(${recita.id}, '${escapeHtml(recita.topic)}')" 
                        class="text-red-500 hover:text-red-700 p-1 transition">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                  </svg>
                </button>
              </div>
            </div>
            <div class="flex gap-2 mt-3">
              <button onclick="startRecita(${recita.id})" 
                      class="flex-1 bg-green-500 text-white text-sm py-2 px-3 rounded hover:bg-green-600 transition">
                Start Recita
              </button>
              <button onclick="exportSingleRecita(${recita.id})" 
                      class="bg-gray-500 text-white text-sm py-2 px-3 rounded hover:bg-gray-600 transition">
                Export
              </button>
            </div>
          </div>
        `;
      }).join('');
    }

    // Add students using your existing API
    async function addStudents() {
      const input = document.getElementById('studentInput');
      const addBtnText = document.getElementById('addBtnText');
      const addBtnSpinner = document.getElementById('addBtnSpinner');
      const addBtn = document.getElementById('addStudentsBtn');
      
      const names = input.value.trim().split('\n').filter(name => name.trim());
      
      if (names.length === 0) {
        alert('Please enter at least one student name');
        input.focus();
        return;
      }

      // Show loading state
      addBtnText.textContent = 'Adding...';
      addBtnSpinner.classList.remove('hidden');
      addBtn.disabled = true;

      try {
        const response = await fetch('/students', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          credentials: 'same-origin',
          body: JSON.stringify({ 
            classId: currentClassId, 
            names: names.map(name => name.trim()) 
          })
        });

        if (!response.ok) {
          const errorText = await response.text();
          throw new Error(`HTTP ${response.status}: ${errorText}`);
        }

        input.value = '';
        await loadStudents();
      } catch (error) {
        console.error('Error adding students:', error);
        alert(`Failed to add students: ${error.message}`);
      } finally {
        // Reset button state
        addBtnText.textContent = 'Add Students';
        addBtnSpinner.classList.add('hidden');
        addBtn.disabled = false;
      }
    }

    // Update student name
    async function updateStudentName(studentId, newName) {
      if (!newName.trim()) return;
      
      try {
        const response = await fetch('/students', {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' },
          credentials: 'same-origin',
          body: JSON.stringify({ 
            studentId: studentId,
            name: newName.trim(),
            classId: currentClassId
          })
        });

        if (response.ok) {
          await loadStudents();
        } else {
          console.error('Failed to update student name');
        }
      } catch (error) {
        console.error('Error updating student:', error);
      }
    }

    // Confirm delete student
    function confirmDeleteStudent(studentId, studentName) {
      showConfirmation(
        'Delete Student',
        `Are you sure you want to delete "${studentName}"? This action cannot be undone.`,
        () => deleteStudent(studentId)
      );
    }

    // Delete student
    async function deleteStudent(studentId) {
      try {
        const response = await fetch(`/students?studentId=${studentId}&classId=${currentClassId}`, {
          method: 'DELETE',
          credentials: 'same-origin'
        });

        if (response.ok) {
          await loadStudents();
        } else {
          console.error('Failed to delete student');
        }
      } catch (error) {
        console.error('Error deleting student:', error);
      }
    }

    // Create recita using your attendance API
    async function createRecita(event) {
      event.preventDefault();
      
      const topic = document.getElementById('recitaTopic').value.trim();
      const createBtnText = document.getElementById('createBtnText');
      const createBtnSpinner = document.getElementById('createBtnSpinner');
      const createBtn = event.target.querySelector('button[type="submit"]');
      
      if (!topic) {
        document.getElementById('recitaTopic').focus();
        return;
      }

      // Show loading state
      createBtnText.textContent = 'Creating...';
      createBtnSpinner.classList.remove('hidden');
      createBtn.disabled = true;

      try {
        const response = await fetch('/attendance', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          credentials: 'same-origin',
          body: JSON.stringify({ 
            classId: currentClassId, 
            topic: topic 
          })
        });

        if (response.ok) {
          const result = await response.json();
          console.log('Recita created:', result);
          document.getElementById('recitaTopic').value = '';
          await loadRecitas();
        } else {
          const errorText = await response.text();
          throw new Error(`HTTP ${response.status}: ${errorText}`);
        }
      } catch (error) {
        console.error('Error creating recita:', error);
        alert(`Failed to create recita: ${error.message}`);
      } finally {
        // Reset button state
        createBtnText.textContent = 'Create Recita';
        createBtnSpinner.classList.add('hidden');
        createBtn.disabled = false;
      }
    }

    // Edit recita (navigate to recita page)
    function editRecita(recitaId) {
      window.location.href = `recita.html?id=${recitaId}`;
    }

    // Confirm delete recita
    function confirmDeleteRecita(recitaId, recitaTopic) {
      showConfirmation(
        'Delete Recita',
        `Are you sure you want to delete "${recitaTopic}"? This will also delete all attendance records for this session.`,
        () => deleteRecita(recitaId)
      );
    }

    // Delete recita using your attendance API DELETE method
    async function deleteRecita(recitaId) {
      try {
        const response = await fetch(`/attendance?recitaId=${recitaId}`, {
          method: 'DELETE',
          credentials: 'same-origin'
        });

        if (response.ok) {
          console.log('Recita deleted successfully');
          await loadRecitas();
        } else {
          const errorText = await response.text();
          console.error('Failed to delete recita:', errorText);
          alert(`Failed to delete recita: ${errorText}`);
        }
      } catch (error) {
        console.error('Error deleting recita:', error);
        alert('Error deleting recita');
      }
    }

    // Start recita
    function startRecita(recitaId) {
      window.location.href = `recita.html?id=${recitaId}`;
    }

    // Export single recita
    async function exportSingleRecita(recitaId) {
      try {
        const response = await fetch(`/export?recitaId=${recitaId}`, {
          credentials: 'same-origin'
        });

        if (response.ok) {
          const blob = await response.blob();
          const url = window.URL.createObjectURL(blob);
          const link = document.createElement('a');
          link.href = url;
          
          const contentDisposition = response.headers.get('Content-Disposition');
          let filename = 'recita-export.csv';
          if (contentDisposition) {
            const match = contentDisposition.match(/filename="(.+)"/);
            if (match) filename = match[1];
          }
          
          link.download = filename;
          document.body.appendChild(link);
          link.click();
          document.body.removeChild(link);
          window.URL.revokeObjectURL(url);
        } else {
          console.error('Export failed:', response.status);
          alert('Export failed');
        }
      } catch (error) {
        console.error('Export error:', error);
        alert('Export failed');
      }
    }

    // Update export button state
    function updateExportButton() {
      const checkboxes = document.querySelectorAll('.recita-checkbox:checked');
      const exportBtn = document.getElementById('exportSelectedBtn');
      exportBtn.disabled = checkboxes.length === 0;
    }

    // Export selected recitas
    async function exportSelectedRecitas() {
      const checkboxes = document.querySelectorAll('.recita-checkbox:checked');
      const selectedIds = Array.from(checkboxes).map(cb => cb.value);
      
      if (selectedIds.length === 0) {
        alert('Please select at least one recita to export');
        return;
      }

      try {
        const response = await fetch(`/export`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          credentials: 'same-origin',
          body: JSON.stringify({ recitaIds: selectedIds })
        });

        if (response.ok) {
          const blob = await response.blob();
          const url = window.URL.createObjectURL(blob);
          const link = document.createElement('a');
          link.href = url;
          link.download = `selected-recitas-${new Date().toISOString().slice(0, 10)}.csv`;
          document.body.appendChild(link);
          link.click();
          document.body.removeChild(link);
          window.URL.revokeObjectURL(url);
        } else {
          console.error('Export failed:', response.status);
          alert('Export failed');
        }
      } catch (error) {
        console.error('Export error:', error);
        alert('Export failed');
      }
    }

    // Select all recitas
    function toggleSelectAllRecitas() {
      const selectAll = document.getElementById('selectAllRecitas');
      const checkboxes = document.querySelectorAll('.recita-checkbox');
      
      checkboxes.forEach(cb => cb.checked = selectAll.checked);
      updateExportButton();
    }

    // Initialize page
    document.addEventListener('DOMContentLoaded', async function() {
      await loadClassInfo();
      await loadStudents();
      await loadRecitas();
      
      // Event listeners
      document.getElementById('addStudentsBtn').addEventListener('click', addStudents);
      document.getElementById('createRecitaForm').addEventListener('submit', createRecita);
      document.getElementById('exportSelectedBtn').addEventListener('click', exportSelectedRecitas);
      document.getElementById('selectAllRecitas').addEventListener('change', toggleSelectAllRecitas);
      
      // Modal event listeners
      document.getElementById('confirmCancel').addEventListener('click', () => {
        document.getElementById('confirmationModal').classList.add('hidden');
        document.getElementById('confirmationModal').classList.remove('flex');
      });
      
      document.getElementById('confirmOk').addEventListener('click', () => {
        document.getElementById('confirmationModal').classList.add('hidden');
        document.getElementById('confirmationModal').classList.remove('flex');
        if (confirmCallback) {
          confirmCallback();
          confirmCallback = null;
        }
      });
      
      // Close modal when clicking outside
      document.getElementById('confirmationModal').addEventListener('click', (e) => {
        if (e.target === document.getElementById('confirmationModal')) {
          document.getElementById('confirmationModal').classList.add('hidden');
          document.getElementById('confirmationModal').classList.remove('flex');
        }
      });
      
      // Close modal with Escape key
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && !document.getElementById('confirmationModal').classList.contains('hidden')) {
          document.getElementById('confirmationModal').classList.add('hidden');
          document.getElementById('confirmationModal').classList.remove('flex');
        }
      });
    });
  </script>
</body>
</html>
